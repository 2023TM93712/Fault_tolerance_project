<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Industrial IoT Gateway Console</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="gradient-bg"></div>

  <!-- Toast notifications -->
  <div id="toast-container"></div>

  <!-- TOP BAR (dashboard only) -->
  <header id="topbar" class="topbar hidden">
    <div class="brand">
      <div class="brand-logo">II</div>
      <div class="brand-text">
        <div class="brand-title">Industrial IoT Gateway</div>
        <div class="brand-subtitle">Fault-tolerant sensor monitoring console</div>
      </div>
    </div>
    <div class="topbar-right">
      <div id="current-user-info" class="user-pill"></div>
      <button id="btn-logout" class="btn btn-outline-small">Logout</button>
    </div>
  </header>

  <!-- AUTH VIEW -->
  <main id="auth-view" class="center-wrap">
    <div class="card auth-card">
      <div class="card-header">
        <div class="brand">
          <div class="brand-logo">II</div>
          <div>
            <div class="brand-title">Industrial IoT Gateway</div>
            <div class="brand-subtitle">
              Secure onboarding and monitoring for edge sensors.
            </div>
          </div>
        </div>
      </div>

      <div class="tabs">
        <button id="tab-login" class="tab active">Login</button>
        <button id="tab-signup" class="tab">Sign up</button>
      </div>

      <!-- LOGIN FORM -->
      <form id="login-form" class="form active">
        <label class="field">
          <span>Username</span>
          <input id="login-username" type="text" placeholder="admin" required />
        </label>

        <label class="field">
          <span>Password</span>
          <input id="login-password" type="password" placeholder="••••••••" required />
        </label>

        <button type="submit" class="btn btn-primary full-width">Login</button>

        <div class="hint">
          <span>First time here?</span>
          <a href="#" id="link-open-signup">Create an account.</a>
        </div>

        <div class="hint tiny">
          Default admin:
          <code>admin</code> / <code>admin123</code> (auto-created in DB).
        </div>
      </form>

      <!-- SIGNUP FORM -->
      <form id="signup-form" class="form">
        <label class="field">
          <span>Username</span>
          <input id="signup-username" type="text" placeholder="john.doe" required />
        </label>

        <label class="field">
          <span>Password</span>
          <input id="signup-password" type="password" required />
        </label>

        <label class="field">
          <span>How many sensors do you need?</span>
          <div class="slider-row">
            <input id="sensor-count" type="range" min="1" max="32" value="8" />
            <span class="slider-value"><span id="sensor-count-value">8</span> devices</span>
          </div>
          <small class="field-hint">
            These virtual UUIDs are created on the gateway and attached to your workspace.
          </small>
        </label>

        <button type="submit" class="btn btn-primary full-width">Create account</button>

        <div class="hint">
          <span>Already registered?</span>
          <a href="#" id="link-open-login">Back to login.</a>
        </div>
      </form>

      <div class="backend-info tiny">
        Backend: auth_service:9001 · sensor_gateway:9002 · alert_worker
      </div>
    </div>
  </main>

  <!-- USER DASHBOARD -->
  <main id="user-view" class="page hidden">
    <div class="page-inner">
      <div class="page-header">
        <div>
          <h1>My sensor workspace</h1>
          <p>Commissioned devices, live signals, and alerts – in one view.</p>
        </div>
      </div>

      <div class="layout-2col">
        <!-- LEFT: SENSORS & CONTROLS -->
        <section class="panel">
          <div class="panel-header">
            <h2>My sensors</h2>
            <button id="btn-refresh-sensors" class="btn btn-outline-small">
              Refresh
            </button>
          </div>
          <div id="sensor-list" class="sensor-list empty-state">
            Loading sensors…
          </div>
        </section>

        <!-- RIGHT: TELEMETRY + LOG TABS -->
        <section class="panel">
          <div class="panel-header panel-header-split">
            <div class="panel-header-left">
              <h2>Workspace</h2>
              <span id="selected-sensor-label" class="tag-muted">
                No sensor selected
              </span>
            </div>
            <div class="segment-control">
              <button class="segment active" data-user-tab="telemetry">
                Live telemetry
              </button>
              <button class="segment" data-user-tab="logs">
                Activity log
              </button>
            </div>
          </div>

          <!-- TELEMETRY TAB -->
          <div id="user-tab-telemetry" class="user-tab active">
            <div class="telemetry-toolbar">
              <div class="telemetry-caption">
                Real-time signal traces for the selected device.
              </div>
              <div class="graph-options">
                <label for="data-points-select">Data points</label>
                <select id="data-points-select">
                  <option value="10">10</option>
                  <option value="20" selected>20</option>
                  <option value="50">50</option>
                </select>
              </div>
            </div>

            <div class="chart-grid chart-grid-four">
              <div class="chart-card">
                <div class="chart-title">Temperature (°C)</div>
                <canvas id="chart-temp" height="120"></canvas>
              </div>

              <div class="chart-card">
                <div class="chart-title">Vibration</div>
                <canvas id="chart-vib" height="120"></canvas>
              </div>

              <div class="chart-card">
                <div class="chart-title">Battery (%)</div>
                <canvas id="chart-batt" height="120"></canvas>
              </div>

              <div class="chart-card">
                <div class="chart-title">
                  Alert events
                  <span class="chart-subtitle">(threshold crossings)</span>
                </div>
                <canvas id="chart-alert" height="120"></canvas>
              </div>
            </div>
          </div>

          <!-- LOG TAB -->
          <div id="user-tab-logs" class="user-tab">
            <div class="panel-header small mb-8">
              <h3>Activity log</h3>
              <span class="tag-muted">Recent actions & gateway hints</span>
            </div>
            <div id="user-log" class="log-panel log-panel-tall"></div>
          </div>
        </section>
      </div>
    </div>
  </main>

  <!-- ADMIN CONSOLE -->
  <main id="admin-view" class="page hidden">
    <div class="page-inner">
      <div class="page-header">
        <div>
          <h1>Plant-wide admin console</h1>
          <p>Approve users, inspect sensors, watch alerts and logs across the floor.</p>
        </div>
      </div>

      <div class="admin-tabs">
        <button class="admin-tab active" data-tab="admin-users">Users</button>
        <button class="admin-tab" data-tab="admin-sensors">Sensors</button>
        <button class="admin-tab" data-tab="admin-alerts">Alerts</button>
        <button class="admin-tab" data-tab="admin-logs">Logs</button>
      </div>

      <!-- USERS TAB -->
      <section id="admin-users" class="admin-tab-body active">
        <div class="panel">
          <div class="panel-header">
            <h2>Users</h2>
            <button id="btn-refresh-users" class="btn btn-outline-small">
              Refresh
            </button>
          </div>
          <div class="table-wrap">
            <table class="table">
              <thead>
                <tr>
                  <th>Username</th>
                  <th>Role</th>
                  <th>Status</th>
                  <th style="width: 110px;">Action</th>
                </tr>
              </thead>
              <tbody id="admin-users-body">
                <tr>
                  <td colspan="4" class="text-center tiny">Loading…</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- SENSORS TAB -->
      <section id="admin-sensors" class="admin-tab-body">
        <div class="panel">
          <div class="panel-header">
            <h2>All sensors</h2>
            <button id="btn-admin-refresh-sensors" class="btn btn-outline-small">
              Refresh
            </button>
          </div>
          <div id="admin-sensor-list" class="sensor-list empty-state">
            Loading sensors…
          </div>
        </div>
      </section>

      <!-- ALERTS TAB -->
      <section id="admin-alerts" class="admin-tab-body">
        <div class="panel">
          <div class="panel-header">
            <h2>Live alerts</h2>
            <span class="tag-muted">Streaming from alert_worker via sensor_gateway</span>
          </div>
          <div id="admin-alerts-panel" class="log-panel log-panel-tall">
            Waiting for alerts…
          </div>
        </div>
      </section>

      <!-- LOGS TAB -->
      <section id="admin-logs" class="admin-tab-body">
        <div class="panel">
          <div class="panel-header">
            <h2>Admin activity log</h2>
            <span class="tag-muted">UI-level actions and approvals</span>
          </div>
          <div id="admin-log" class="log-panel log-panel-tall"></div>
        </div>
      </section>
    </div>
  </main>

  <script src="app.js"></script>
</body>
</html>
